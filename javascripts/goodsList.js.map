{"version":3,"sources":["shoppingcar.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"goodsList.js","sourcesContent":["\r\nfunction getMsg(){\r\n\r\n    $.ajax(\"https://list.mogujie.com/search\",\r\n    {\r\n          dataType:\"jsonp\"\r\n    })\r\n    .then(function(res){\r\n          console.log(res);\r\n          renderPage(res.result.wall.list);\r\n    })\r\n\r\n}\r\n\r\nvar goodsJson = [];\r\nvar container =  document.getElementById(\"wrap\");\r\nfunction renderPage(json){\r\n \r\n      goodsJson = json;\r\n      var html = \"\";\r\n      // 根据比例计算图片高度;\r\n      json.forEach(function(ele){\r\n            html += `<li class =\"box\">\r\n              <img data-iid = ${ele.iid} src = \"${ele.show.img}\" width=${ 220 } height=${260 }  alt=\"\">\r\n              <p >${ele.title}</p>\r\n              <div class=\"line\"></div>\r\n              <div class=\"goodsprice\"><span>${ele.price}</span>\r\n              <b>${ele.orgPrice}</b>\r\n              </div>\r\n              <strong class=\"btn-car\" data-iid = ${ele.iid}>加入购物车</strong>\r\n             \r\n              </li>\r\n            `  \r\n        });\r\n    //   $(\"#wrap\").html(html);\r\n    container.innerHTML += html;\r\n\r\n}\r\ngetMsg()\r\n\r\nvar GLOBAL = {\r\n    ch:document.documentElement.clientHeight, //可视化高度；\r\n    loading_flag:false, //关闭ajax请求\r\n    num:1\r\n}\r\n// 无限加载\r\nonscroll = function(){\r\n    if(!isload() || GLOBAL.loading_flag) return false;\r\n    GLOBAL.loading_flag = true;\r\n    $.ajax(\"https://list.mogujie.com/search\",\r\n    {\r\n          dataType:\"jsonp\"\r\n    })\r\n    .then(function(res){\r\n        //   console.log(res);\r\n        GLOBAL.loading_flag = false;\r\n        GLOBAL.num++;\r\n        renderPage(res.result.wall.list);\r\n       \r\n    })\r\n\r\n}\r\nfunction isload(){\r\n    // 关键参数不存在，函数不执行；\r\n    var st = document.body.scrollTop || document.documentElement.scrollTop;\r\n    // var mh = Math.min.apply(flase,)\r\n    \r\n    if(GLOBAL.ch + st >= 5480*GLOBAL.num - 1000){\r\n        return true;\r\n    }else{\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n// 购物车\r\n// 1.所有的按钮绑定事件；\r\n// console.log($(\"#wrap\"))\r\n\r\n$(\"#wrap\").on(\"click\",\".btn-car\",handleCarClick);\r\nfunction handleCarClick(event){\r\n      var e = event || window.event;\r\n      var target = e.target || e.srcElement;\r\n      var iid = $(target).attr(\"data-iid\");\r\n      var nowMsg = findJson(iid)[0];\r\n      // console.log(nowMsg.iid)\r\n      addCar(nowMsg,iid);\r\n      renderCart()\r\n}\r\n\r\n// 详情页跳转\r\n$(\"#wrap\").on(\"click\",\"img\",handleImgClick);\r\nfunction handleImgClick(event){\r\n      var e = event || window.event;\r\n      var target = e.target || e.srcElement;\r\n      var iid = $(target).attr(\"data-iid\");\r\n      console.log(iid)\r\n      var imgMsg = findJson(iid)[0];\r\n      // console.log(imgMsg)\r\n      localStorage.setItem(\"detail\",JSON.stringify(imgMsg))\r\n      location.href = \"http://localhost:8001/detail.html\"\r\n}\r\n// localStroage的特征：\r\n// 1. 增删改查 ; setItem getItem length key() clear();\r\n// 2. 遵循同源策略; \r\n// 3. 只能存储纯字符;\r\n\r\n\r\nfunction addCar(nowMsg , iid){\r\n      // 存数据;\r\n      // 1. 因为我们要存的数据是对象,但是localstroage可以存储的数据只有字符;\r\n      // object => string;\r\n      $.extend(nowMsg , {count : 1});\r\n      var sNowMsg = JSON.stringify(nowMsg);\r\n      // console.log(sNowMsg)\r\n\r\n      if(!localStorage.cart){\r\n            localStorage.setItem(\"cart\",`[${sNowMsg}]`);\r\n            return false;\r\n      }\r\n      // 如果存在对结构进行插入;\r\n      var aMsg = JSON.parse(localStorage.cart);\r\n      // console.log(aMsg);\r\n      if(!hasIid(aMsg,iid)){\r\n            aMsg.push(nowMsg);\r\n      }\r\n\r\n      // localStorage重新设置；\r\n      localStorage.setItem(\"cart\",JSON.stringify(aMsg))\r\n      console.log(JSON.parse(localStorage.cart));\r\n}\r\n\r\n\r\nfunction hasIid(aMsg,iid){\r\n      \r\n      for(var i = 0 ; i < aMsg.length ; i ++){\r\n            if(aMsg[i].iid === iid){\r\n                  aMsg[i].count ++;\r\n                  return true;\r\n            }          \r\n      }\r\n      return false;\r\n}\r\n\r\nfunction findJson(iid){\r\n      return  goodsJson.filter(function(item){\r\n            return  item.iid === iid\r\n      })\r\n}\r\n\r\n// 购物车获取;;\r\n\r\n$(\".go_buy\").on(\"mouseenter\",function(){\r\n      $(\".car-list\").show();\r\n      // console.log(getCart())\r\n     $(\".car-list ul\").html(renderCart());\r\n     renderCart();\r\n\r\n})\r\n$(\".go_buy\").on(\"mouseleave\",function(){\r\n      $(\".car-list\").hide();\r\n      renderCart();\r\n})\r\n\r\nfunction getCart(){\r\n//     console.log(localStorage.cart)\r\n      if(!localStorage.cart) return 0;\r\n      var aMsg = JSON.parse(localStorage.cart);\r\n      return aMsg;\r\n}\r\n\r\nrenderCart()\r\nfunction renderCart(){\r\n      var html = \"\";\r\n      var cart_json = getCart();\r\n      if(!cart_json) return 0;\r\n      var sumlist = 0;\r\n      for(var i = 0 ; i < cart_json.length ; i ++){\r\n            html += `<li>\r\n            <img src=\"${cart_json[i].show.img}\"> \r\n            <span class=\"car_price\">${cart_json[i].price}</span>\r\n             <span class=\"car_count\">${cart_json[i].count}</span>\r\n             </li>`\r\n             sumlist += cart_json[i].count ;\r\n      }\r\n      $(\".buy_num\").html(sumlist);\r\n      return html;\r\n}\r\n$(\".clear_btn\").on(\"click\",function(){\r\n      localStorage.clear(\"cart\");\r\n      $(\".buy_num\").html(\"0\");\r\n      $(\".car-list ul\").html(\"\")\r\n})\r\n\r\n"]}